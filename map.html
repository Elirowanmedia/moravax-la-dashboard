<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Moravax Louisiana Pilot — Night Lights</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body, #map { height:100%; margin:0 }
    .panel {
      position:absolute; left:12px; bottom:12px;
      background:#111; color:#fff; border-radius:12px;
      padding:10px 12px; font:13px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Arial;
      box-shadow:0 2px 10px rgba(0,0,0,.35); opacity:.95;
    }
    .panel label { display:block; margin-top:6px; cursor:pointer }
    /* Make NASA lights pop so the toggle is obvious */
    .radiance-tiles { filter: brightness(2.2) contrast(1.6) saturate(1.1); }
    .blackmarble-tiles { filter: brightness(1.2) contrast(1.2); }
  </style>
</head>
<body>
<div id="map"></div>

<script>
  // --- Mapbox basemap ---
  const MAPBOX_TOKEN =
    'pk.eyJ1IjoiZWxpcm93YW5tZWRpYSIsImEiOiJjbWV5d2Y5MWkwN2hzMnFwbG5idDhxa2E0In0.c09E3SqLY_s5bnQzo-M7qA';

  const mapboxDark = L.tileLayer(
    `https://api.mapbox.com/styles/v1/mapbox/dark-v11/tiles/256/{z}/{x}/{y}?access_token=${MAPBOX_TOKEN}`,
    { maxZoom: 19, attribution: '© OpenStreetMap · © Mapbox' }
  );

  const map = L.map('map', {
    center: [30.14, -90.79],  // River Parishes
    zoom: 7,
    layers: [mapboxDark]
  });

  // --- NASA layers ---
  // Bright, per-pixel radiance (great for public demos)
  const VIIRS_DATE = '2024-12-31';
  const viirsRadiance = L.tileLayer(
    `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/VIIRS_SNPP_DayNightBand_At_Sensor_Radiance/default/${VIIRS_DATE}/GoogleMapsCompatible_Level8/{z}/{y}/{x}.png`,
    { tileSize:256, opacity:0.85, className:'radiance-tiles', attribution:'NASA VIIRS DNB Radiance' }
  ).addTo(map); // start ON so you can see the effect immediately

  // Subtle annual composite (scientific, but visually faint)
  const BLACK_MARBLE_DATE = '2024-01-01';
  const blackMarble = L.tileLayer(
    `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/VIIRS_Black_Marble/default/${BLACK_MARBLE_DATE}/GoogleMapsCompatible_Level8/{z}/{y}/{x}.jpg`,
    { tileSize:256, opacity:0.8, className:'blackmarble-tiles', attribution:'NASA Black Marble' }
  );

  // --- Simple panel with radio buttons to switch the NASA layer ---
  const Panel = L.Control.extend({
    onAdd: function() {
      const d = L.DomUtil.create('div','panel');
      d.innerHTML = `
        <b>Moravax Pilot Layers</b>
        <div style="margin-top:6px; opacity:.8">Night lights overlay:</div>
        <label><input type="radio" name="nasa" value="radiance" checked> VIIRS DNB Radiance (bright)</label>
        <label><input type="radio" name="nasa" value="blackmarble"> Black Marble (subtle)</label>
        <div style="margin-top:6px; font-size:12px; opacity:.75">
          Tip: zoom to 8–12 for best contrast.
        </div>`;
      // prevent map drag when clicking panel
      L.DomEvent.disableClickPropagation(d);
      return d;
    }
  });
  map.addControl(new Panel({ position: 'bottomleft' }));

  // Handle radio changes
  document.addEventListener('change', (e) => {
    if (e.target && e.target.name === 'nasa') {
      if (e.target.value === 'radiance') {
        map.removeLayer(blackMarble);
        viirsRadiance.addTo(map);
      } else {
        map.removeLayer(viirsRadiance);
        blackMarble.addTo(map);
      }
    }
  });
</script>
</body>
</html>
